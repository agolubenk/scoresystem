{% extends 'positions/base.html' %}
{% block title %}–ö–∞–Ω–¥–∏–¥–∞—Ç—ã{% endblock %}

{% block extra_css %}
<style>
.pdf-preview-btn {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
    line-height: 1.5;
    border-radius: 0.2rem;
    color: #6c757d;
    background-color: transparent;
    border: 1px solid #6c757d;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    margin-right: 0.5rem;
}
.pdf-preview-btn:hover {
    color: #fff;
    background-color: #6c757d;
    border-color: #6c757d;
    text-decoration: none;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4" style="background: var(--bg-secondary); min-height: 100vh;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 style="color: var(--dropdown-text);">–ö–∞–Ω–¥–∏–¥–∞—Ç—ã</h2>
        <a href="{% url 'positions:candidate_create' %}" class="btn btn-success"><i class="bi bi-person-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞</a>
    </div>
    <form method="get" class="mb-3">
        <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="–ü–æ–∏—Å–∫ –ø–æ –§–ò–û..." value="{{ request.GET.q }}">
            <button class="btn btn-outline-secondary" type="submit">–ü–æ–∏—Å–∫</button>
        </div>
    </form>
    <div class="card" style="background: var(--bg-secondary); color: var(--dropdown-text); box-shadow: var(--card-shadow);">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover align-middle" style="background: var(--bg-secondary); color: var(--dropdown-text);">
                    <thead>
                        <tr>
                            <th>–§–ò–û</th>
                            <th>Email</th>
                            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                            <th>Telegram</th>
                            <th>–ñ–µ–ª–∞–µ–º–∞—è –¥–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for candidate in candidates %}
                        <tr>
                            <td><a href="{% url 'positions:candidate_detail' candidate.pk %}" class="fw-semibold text-decoration-none" style="color: var(--btn-primary-bg);">{{ candidate.full_name }}</a></td>
                            <td>{% if candidate.email %}<a href="mailto:{{ candidate.email }}" class="text-decoration-none">{{ candidate.email }}</a>{% endif %}</td>
                            <td><span class="phone-flag" data-phone="{{ candidate.phone|default:'' }}"></span>{% if candidate.phone %}<a href="tel:{{ candidate.phone }}" class="text-decoration-none">{{ candidate.phone }}</a>{% endif %}</td>
                            <td>{% if candidate.telegram %}<a href="{{ candidate.get_telegram_link }}" target="_blank" class="text-decoration-none">@{{ candidate.get_telegram_username }}</a>{% endif %}</td>
                            <td>{{ candidate.desired_position.name }}</td>
                            <td class="text-end">
                                <a href="{% url 'positions:candidate_delete' candidate.pk %}" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="6" class="text-center text-muted">–ù–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if is_paginated %}
            <nav>
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">–ù–∞–∑–∞–¥</a></li>
                    {% endif %}
                    {% for num in paginator.page_range %}
                    <li class="page-item {% if page_obj.number == num %}active{% endif %}"><a class="page-link" href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">{{ num }}</a></li>
                    {% endfor %}
                    {% if page_obj.has_next %}
                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">–í–ø–µ—Ä—ë–¥</a></li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ PDF -->
<div class="modal fade" id="pdfPreviewModal" tabindex="-1" aria-labelledby="pdfPreviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="pdfPreviewModalLabel">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—é–º–µ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">
                <iframe id="pdfViewer" style="width: 100%; height: 80vh; border: none;"></iframe>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// === –§–ª–∞–≥–∏ –∏ —Å—Ç—Ä–∞–Ω—ã –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–º –∫–æ–¥–∞–º ===
const countryPhoneData = [
    { code: '+1', flag: 'üá∫üá∏', name: '–°–®–ê/–ö–∞–Ω–∞–¥–∞' },
    { code: '+7', flag: 'üá∑üá∫', name: '–†–æ—Å—Å–∏—è' },
    { code: '+375', flag: 'üáßüáæ', name: '–ë–µ–ª–∞—Ä—É—Å—å' },
    { code: '+380', flag: 'üá∫üá¶', name: '–£–∫—Ä–∞–∏–Ω–∞' },
    { code: '+48', flag: 'üáµüá±', name: '–ü–æ–ª—å—à–∞' },
    { code: '+371', flag: 'üá±üáª', name: '–õ–∞—Ç–≤–∏—è' },
    { code: '+370', flag: 'üá±üáπ', name: '–õ–∏—Ç–≤–∞' },
    { code: '+372', flag: 'üá™üá™', name: '–≠—Å—Ç–æ–Ω–∏—è' },
    { code: '+49', flag: 'üá©üá™', name: '–ì–µ—Ä–º–∞–Ω–∏—è' },
    { code: '+420', flag: 'üá®üáø', name: '–ß–µ—Ö–∏—è' },
    { code: '+44', flag: 'üá¨üáß', name: '–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è' },
    { code: '+33', flag: 'üá´üá∑', name: '–§—Ä–∞–Ω—Ü–∏—è' },
    { code: '+39', flag: 'üáÆüáπ', name: '–ò—Ç–∞–ª–∏—è' },
    { code: '+34', flag: 'üá™üá∏', name: '–ò—Å–ø–∞–Ω–∏—è' },
    { code: '+81', flag: 'üáØüáµ', name: '–Ø–ø–æ–Ω–∏—è' },
    { code: '+86', flag: 'üá®üá≥', name: '–ö–∏—Ç–∞–π' },
    { code: '+91', flag: 'üáÆüá≥', name: '–ò–Ω–¥–∏—è' },
    { code: '+61', flag: 'üá¶üá∫', name: '–ê–≤—Å—Ç—Ä–∞–ª–∏—è' },
    { code: '+82', flag: 'üá∞üá∑', name: '–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è' },
    { code: '+90', flag: 'üáπüá∑', name: '–¢—É—Ä—Ü–∏—è' },
    { code: '+351', flag: 'üáµüáπ', name: '–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è' },
    { code: '+36', flag: 'üá≠üá∫', name: '–í–µ–Ω–≥—Ä–∏—è' },
    { code: '+43', flag: 'üá¶üáπ', name: '–ê–≤—Å—Ç—Ä–∏—è' },
    { code: '+31', flag: 'üá≥üá±', name: '–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã' },
    { code: '+32', flag: 'üáß–µ–ª—å–≥–∏—è' },
    { code: '+358', flag: 'üá´üáÆ', name: '–§–∏–Ω–ª—è–Ω–¥–∏—è' },
    { code: '+46', flag: 'üá∏üá™', name: '–®–≤–µ—Ü–∏—è' },
    { code: '+47', flag: 'üá≥üá¥', name: '–ù–æ—Ä–≤–µ–≥–∏—è' },
    { code: '+45', flag: 'üá©üá∞', name: '–î–∞–Ω–∏—è' },
    { code: '+420', flag: 'üá®üáø', name: '–ß–µ—Ö–∏—è' },
    { code: '+421', flag: 'üá∏üá∞', name: '–°–ª–æ–≤–∞–∫–∏—è' },
    { code: '+386', flag: 'üá∏üáÆ', name: '–°–ª–æ–≤–µ–Ω–∏—è' },
    { code: '+385', flag: 'üá≠üá∑', name: '–•–æ—Ä–≤–∞—Ç–∏—è' },
    { code: '+357', flag: 'üá®üáæ', name: '–ö–∏–ø—Ä' },
    { code: '+30', flag: 'üá¨üá∑', name: '–ì—Ä–µ—Ü–∏—è' },
    { code: '+40', flag: 'üá∑üá¥', name: '–†—É–º—ã–Ω–∏—è' },
];
countryPhoneData.sort((a, b) => b.code.length - a.code.length);
function getCountryData(phone) {
    if (!phone) return { flag: '', name: '' };
    phone = phone.replace(/\s|\(|\)/g, '');
    for (const item of countryPhoneData) {
        if (phone.startsWith(item.code)) {
            return item;
        }
    }
    return { flag: '', name: '' };
}
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.phone-flag').forEach(function(span) {
        const phone = span.dataset.phone;
        const { flag } = getCountryData(phone);
        if (flag) {
            span.innerHTML = `<span style="font-size:1.3em;vertical-align:middle;">${flag}</span> `;
        }
    });
});
</script>
{% endblock %} 